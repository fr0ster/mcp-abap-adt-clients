# Test Configuration Template for @mcp-abap-adt/adt-clients
# Copy this file to test-config.yaml and configure for your environment
# AdtClient Tests Configuration
#
# Usage:
#   cp src/__tests__/helpers/test-config.yaml.template src/__tests__/helpers/test-config.yaml
#   # Edit test-config.yaml with your specific values
#
# IMPORTANT: Object Naming Convention
# ===================================
# All test objects must use the ZADT_BLD_* naming convention:
# - Classes: ZADT_BLD_CLS01, ZADT_BLD_CLS02, etc.
# - Domains: ZADT_BLD_DOM01, ZADT_BLD_DOM02, etc.
# - Data Elements: ZADT_BLD_DTEL01, ZADT_BLD_DTEL02, etc.
# - Function Modules: Z_ADT_BLD_FM01, Z_ADT_BLD_FM02, etc. (must start with Z_ or Y_)
# - Function Groups: ZADT_BLD_FGR01, ZADT_BLD_FGR02, etc.
# - Interfaces: ZADT_BLD_IF01, ZADT_BLD_IF02, etc.
# - Programs: ZADT_BLD_PROG01, ZADT_BLD_PROG02, etc.
# - Tables: ZADT_BLD_TAB01, ZADT_BLD_TAB02, etc.
# - TableTypes: ZADT_BLD_TTYP01, ZADT_BLD_TTYP02, etc.
# - Structures: ZADT_BLD_STRU01, ZADT_BLD_STRU02, etc.
# - Views: ZADT_BLD_VIEW01, ZADT_BLD_VIEW02, etc.
# - Service Definitions: ZADT_BLD_SRVD01, ZADT_BLD_SRVD02, etc.
# - Service Bindings: ZADT_BLD_SRVB01, ZADT_BLD_SRVB02, etc.
# - Packages: ZADT_BLD_PKG01, ZADT_BLD_PKG02, etc.
#
# Test settings
test_settings:
  fail_fast: false
  verbose: true
  timeout: 60000  # Global test timeout (60 seconds)
  retry_on_failure: false
  max_retries: 1
  cleanup_after_test: false
  allow_406: false  # Allow 406 Not Acceptable to be treated as skip (override per test case)
  # Timeouts for different operations (in milliseconds)
  timeouts:
    default: 60000
    long: 200000  # Long timeout for complex operations (group deletion, etc.)
    create: 60000
    delay: 3000  # Delay after delete/create operations
  # Operation delays (milliseconds) - time to wait for SAP to commit operations
  # These delays ensure SAP has time to persist state changes between operations
  operation_delays:
    lock: 3000      # Delay after lock operation (default: 3 seconds)
    unlock: 3000    # Delay after unlock operation (default: 3 seconds)
    update: 3000    # Delay after update operation (default: 3 seconds)
    create: 3000    # Delay after create operation (default: 3 seconds)
    activate: 3000   # Delay after activate operation (default: 3 seconds)
    default: 3000   # Default delay for any operation (default: 3 seconds)

# Session persistence configuration
session_config:
  # Enable session persistence (saves cookies and CSRF tokens)
  persist_session: true
  # Directory for session files (relative to project root)
  sessions_dir: ".sessions"
  # Session ID format: {test_name}_{timestamp} or custom
  session_id_format: "auto"  # "auto" or custom string
  # Clean up session after test
  cleanup_session_after_test: false

# Lock persistence configuration
lock_config:
  # Directory for lock files (relative to project root)
  locks_dir: ".locks"
  # Track locks in persistent storage
  persist_locks: true

# Environment configuration
environment:
  default_package: "ZADT_BLD_PKG01"  # Default package for creating objects (used if not specified in test case)
  default_transport: ""  # Default transport request (used if not specified in test case)
  skip_cleanup: false    # Skip cleanup after test (objects left for analysis) - can be overridden per test case

# Standard SAP objects registry for read-only tests
standard_objects:
  classes:
    - name: "CL_ABAP_CHAR_UTILITIES"
      description: "Character utilities helper (available everywhere)"
      available_in: ["onprem", "cloud"]
    - name: "CL_ABAP_CORRESPONDING"
      description: "Corresponding-move helper for ABAP"
      available_in: ["onprem", "cloud"]

  interfaces:
    - name: "IF_BUPA_API_MODIFY"
      description: "Interface zum BAdI: BUPA_API_MODIFY"
      available_in: ["onprem", "cloud"]

  domains:
    - name: "MANDT"
      description: "Client domain"
      available_in: ["onprem", "cloud"]
    - name: "ABAP_BOOL"
      description: "Boolean domain"
      available_in: ["onprem", "cloud"]

  data_elements:
    - name: "MANDT"
      description: "Client data element"
      available_in: ["onprem", "cloud"]
    - name: "ABAP_BOOL"
      description: "Boolean data element"
      available_in: ["onprem", "cloud"]

  tables:
    - name: "T000"
      description: "Client table (on-premise SAP systems)"
      available_in: ["onprem"]
    - name: "T000"
      description: "Clients"
      available_in: ["cloud"]

  tabletypes:
    - name: "STRING_TABLE"
      description: "Standard string table type"
      available_in: ["onprem", "cloud"]

  structures:
    - name: "SYST"
      description: "System fields structure"
      available_in: ["onprem", "cloud"]

  packages:
    - name: "$TMP"
      description: "Local package"
      available_in: ["onprem"]
    - name: "ZLOCAL"
      description: "Placeholder for ABAP Cloud package – replace with existing package"
      available_in: ["cloud"]

  programs:
    - name: "SAPLSETB"
      description: "Standard SAP settings program"
      available_in: ["onprem"]

  views:
    - name: "H_T000"
      description: "Client table help view"
      available_in: ["onprem"]
    - name: "I_SapPackage"
      description: "ABAP Cloud: replace with CDS view name existing in tenant"
      available_in: ["cloud"]

  function_groups:
    - name: "EDIN"
      description: "System function group"
      available_in: ["onprem", "cloud"]

  function_modules:
    - name: "IDOC_INBOUND_XML_SOAP_HTTP"
      group: "EDIN"
      description: "Returns system metadata"
      available_in: ["onprem", "cloud"]

  service_definitions:
    - name: "I_SapPackage"
      description: "ABAP Cloud: replace with service definition name existing in tenant"
      available_in: ["cloud"]
    - name: "ZPLACEHOLDER_SRVD"
      description: "Placeholder for on-premise service definition – replace with existing service definition"
      available_in: ["onprem"]

  service_bindings:
    - name: "ZPLACEHOLDER_SRVB"
      description: "Placeholder for service binding – replace with existing service binding"
      available_in: ["onprem", "cloud"]

  standard_criteria:
    note: "Update the entries above with objects that exist in your SAP system before running read tests."

# ============================================================================
# READ TESTS (Read-only operations on existing objects)
# ============================================================================
# 
# Each test case can specify `available_in` parameter to conditionally enable/disable
# tests for specific environments:
#   - available_in: ["cloud"] - only run on cloud systems
#   - available_in: ["onprem"] - only run on on-premise systems  
#   - available_in: ["cloud", "onprem"] or omit - run on both environments
#
# Example:
#   - name: "my_test"
#     enabled: true
#     available_in: ["onprem"]  # Skip this test on cloud systems
#     params: {}
# ============================================================================

# Read Program (AdtClient)
# Uses standard_objects.programs with available_in filter
read_program:
  test_cases:
    - name: "readonly_read_program"
      enabled: false  # Set to true to enable read test
      available_in: ["onprem"]  # Programs are not supported in cloud systems (BTP ABAP Environment)
      description: "Read existing program using AdtClient (uses standard_objects.programs). Programs are not supported in cloud systems."
      params: {}  # No params needed - automatically uses standard_objects.programs filtered by available_in

# Read Class (AdtClient)
# Uses standard_objects.classes with available_in filter
read_class:
  test_cases:
    - name: "readonly_read_class"
      enabled: false  # Set to true to enable read test
      description: "Read existing class using AdtClient (uses standard_objects.classes)"
      params: {}  # No params needed - automatically uses standard_objects.classes filtered by available_in

# Read Interface (AdtClient)
# Uses standard_objects.interfaces with available_in filter
read_interface:
  test_cases:
    - name: "readonly_read_interface"
      enabled: false  # Set to true to enable read test
      description: "Read existing interface using AdtClient (uses standard_objects.interfaces)"
      params: {}  # No params needed - automatically uses standard_objects.interfaces filtered by available_in

# Read Domain (AdtClient)
# Uses standard_objects.domains with available_in filter
read_domain:
  test_cases:
    - name: "readonly_read_domain"
      enabled: false  # Set to true to enable read test
      description: "Read existing domain using AdtClient (uses standard_objects.domains)"
      params: {}  # No params needed - automatically uses standard_objects.domains filtered by available_in

# Read Data Element (AdtClient)
# Uses standard_objects.data_elements with available_in filter
read_data_element:
  test_cases:
    - name: "readonly_read_data_element"
      enabled: false  # Set to true to enable read test
      description: "Read existing data element using AdtClient (uses standard_objects.data_elements)"
      params: {}  # No params needed - automatically uses standard_objects.data_elements filtered by available_in

# Read Structure (AdtClient)
# Uses standard_objects.structures with available_in filter
read_structure:
  test_cases:
    - name: "readonly_read_structure"
      enabled: false  # Set to true to enable read test
      description: "Read existing structure using AdtClient (uses standard_objects.structures)"
      params: {}  # No params needed - automatically uses standard_objects.structures filtered by available_in

# Read Table (AdtClient)
# Uses standard_objects.tables with available_in filter
# Note: On cloud systems, 99% of tables are not readable via ADT endpoint
read_table:
  test_cases:
    - name: "readonly_read_table"
      enabled: false  # Set to true to enable read test
      available_in: ["onprem"]  # Only available on on-premise (tables endpoint cannot read tables on cloud)
      description: "Read existing table using AdtClient (uses standard_objects.tables). On cloud, 99% of tables are not readable via ADT."
      params: {}  # No params needed - automatically uses standard_objects.tables filtered by available_in

# Read View (AdtClient)
# Uses standard_objects.views with available_in filter
read_view:
  test_cases:
    - name: "readonly_read_view"
      enabled: false  # Set to true to enable read test
      description: "Read existing view using AdtClient (uses standard_objects.views)"
      params: {}  # No params needed - automatically uses standard_objects.views filtered by available_in

# Read Function Group (AdtClient)
# Uses standard_objects.function_groups with available_in filter
read_function_group:
  test_cases:
    - name: "readonly_read_function_group"
      enabled: false  # Set to true to enable read test
      description: "Read existing function group using AdtClient (uses standard_objects.function_groups)"
      params: {}  # No params needed - automatically uses standard_objects.function_groups filtered by available_in

# Read Function Module (AdtClient)
# Uses standard_objects.function_modules with available_in filter
read_function_module:
  test_cases:
    - name: "readonly_read_function_module"
      enabled: false  # Set to true to enable read test
      description: "Read existing function module using AdtClient (uses standard_objects.function_modules)"
      params: {}  # No params needed - automatically uses standard_objects.function_modules filtered by available_in

# Read Package (AdtClient)
# Uses standard_objects.packages with available_in filter
read_package:
  test_cases:
    - name: "readonly_read_package"
      enabled: false  # Set to true to enable read test
      description: "Read existing package using AdtClient (uses standard_objects.packages)"
      params: {}  # No params needed - automatically uses standard_objects.packages filtered by available_in

# Read Service Definition (AdtClient)
# Uses standard_objects.service_definitions with available_in filter
read_service_definition:
  test_cases:
    - name: "readonly_read_service_definition"
      enabled: false  # Set to true to enable read test
      description: "Read existing service definition using AdtClient (uses standard_objects.service_definitions)"
      params: {}  # No params needed - automatically uses standard_objects.service_definitions filtered by available_in
    - name: "read_standard_service_definition"
      enabled: false  # Set to true and configure params below to enable read test
      description: "Read standard SAP service definition"
      params:
        # Specify standard object name directly (overrides standard_objects registry)
        service_definition_name: "I_SapPackage"  # Replace with existing service definition in your system
        # Or use environment-specific parameters:
        # service_definition_name_cloud: "I_SapPackage"  # For cloud systems only
        # service_definition_name_onprem: "ZPLACEHOLDER_SRVD"  # For on-premise systems only

# Read Service Binding (AdtClient)
# Uses standard_objects.service_bindings with available_in filter
read_service_binding:
  test_cases:
    - name: "readonly_read_service_binding"
      enabled: false  # Set to true to enable read test
      description: "Read existing service binding using AdtClient (uses standard_objects.service_bindings)"
      params: {}  # No params needed - automatically uses standard_objects.service_bindings filtered by available_in

# Read Transport Request (AdtClient)
read_transport:
  test_cases:
    - name: "readonly_read_transport"
      enabled: false  # Set to true and configure params below to enable read test
      description: "Read existing transport request using AdtClient"
      params:
        transport_request: ""  # Replace with existing transport request in your system

# ============================================================================
# FLOW TESTS (Create/Update/Delete operations - AdtClient tests)
# ============================================================================
#
# Flow tests support available_in parameter to conditionally enable/disable tests
# based on environment (cloud/on-premise):
#   - available_in: ["cloud"] - only run on cloud systems
#   - available_in: ["onprem"] - only run on on-premise systems  
#   - available_in: ["cloud", "onprem"] or omit - run on both environments
#
# Example:
#   - name: "my_test"
#     enabled: true
#     available_in: ["onprem"]  # Skip this test on cloud systems
#     params: {}
# ============================================================================

# Create Class
create_class:
  test_cases:
    - name: "adt_class"
      enabled: true
      description: "Create test class for AdtClass tests"
      params:
        class_name: "ZADT_BLD_CLS01"
        description: "AdtClass workflow class"
        # package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        superclass: ""
        final: true
        # Optional: Override operation delays for this specific test (in milliseconds)
        # operation_delays:
        #   lock: 5000      # Custom delay after lock (overrides global setting)
        #   unlock: 5000    # Custom delay after unlock
        #   update: 5000    # Custom delay after update
        #   create: 4000    # Custom delay after create
        source_code: |
          CLASS ZADT_BLD_CLS01 DEFINITION
            PUBLIC
            FINAL
            CREATE PUBLIC .

            PUBLIC SECTION.
              TYPES:
                BEGIN OF ty_parent,
                  fld1 TYPE char10,
                  fld2 TYPE string,
                  fld3 TYPE char8,
                END OF ty_parent,
                ty_parent_tab TYPE STANDARD TABLE OF ty_parent WITH DEFAULT KEY,
                BEGIN OF ty_child,
                  parent_id TYPE char10,
                  chld_id   TYPE char10,
                END OF ty_child,
                ty_child_tab TYPE STANDARD TABLE OF ty_child WITH DEFAULT KEY.

              METHODS:
                get_text RETURNING VALUE(rv_text) TYPE string.
              CLASS-METHODS:
                build_parent_data RETURNING VALUE(rt_parent) TYPE ty_parent_tab,
                build_child_data  RETURNING VALUE(rt_child)  TYPE ty_child_tab.
            PROTECTED SECTION.
            PRIVATE SECTION.
          ENDCLASS.

# Update Class LocalDefinitions (definitions include: private types/data)
update_class_local_definitions:
  test_cases:
    - name: "local_definitions"
      enabled: false
      description: "Update class definitions include (local types/data in class private section)"
      params:
        class_name: "ZADT_BLD_CLS10"
        # package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        definitionsCode_create: |
          TYPES: BEGIN OF ty_local_dummy,
                   value TYPE i,
                 END OF ty_local_dummy.
          CONSTANTS gc_local_dummy TYPE string VALUE 'X'.
        definitionsCode_update: |
          TYPES: BEGIN OF ty_local_dummy,
                   value TYPE i,
                 END OF ty_local_dummy.
          CONSTANTS gc_local_dummy TYPE string VALUE 'Y'.

# Update Class LocalTypes (implementations include: local helper class)
update_class_local_types:
  test_cases:
    - name: "local_types"
      enabled: false
      description: "Update class implementations include (local helper class/types)"
      params:
        class_name: "ZADT_BLD_CLS11"
        # package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        localTypesCode_create: |
          CLASS lcl_helper DEFINITION FINAL.
            PUBLIC SECTION.
              CLASS-METHODS get_value RETURNING VALUE(rv_value) TYPE i.
          ENDCLASS.

          CLASS lcl_helper IMPLEMENTATION.
            METHOD get_value.
              rv_value = 1.
            ENDMETHOD.
          ENDCLASS.
        localTypesCode_update: |
          CLASS lcl_helper DEFINITION FINAL.
            PUBLIC SECTION.
              CLASS-METHODS get_value RETURNING VALUE(rv_value) TYPE i.
          ENDCLASS.

          CLASS lcl_helper IMPLEMENTATION.
            METHOD get_value.
              rv_value = 2.
            ENDMETHOD.
          ENDCLASS.

# Update Class LocalTestClass (testclasses include: local ABAP Unit tests)
update_class_local_testclass:
  test_cases:
    - name: "local_testclass"
      enabled: false
      description: "Update class testclasses include (local ABAP Unit test class)"
      params:
        class_name: "ZADT_BLD_CLS12"
        # package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        testClassCode_create: |
          CLASS ltcl_local_test DEFINITION FINAL FOR TESTING DURATION SHORT RISK LEVEL HARMLESS.
            PRIVATE SECTION.
              METHODS test_basic FOR TESTING.
          ENDCLASS.

          CLASS ltcl_local_test IMPLEMENTATION.
            METHOD test_basic.
              cl_abap_unit_assert=>assert_equals( exp = 1 act = 1 ).
            ENDMETHOD.
          ENDCLASS.
        testClassCode_update: |
          CLASS ltcl_local_test DEFINITION FINAL FOR TESTING DURATION SHORT RISK LEVEL HARMLESS.
            PRIVATE SECTION.
              METHODS test_basic FOR TESTING.
          ENDCLASS.

          CLASS ltcl_local_test IMPLEMENTATION.
            METHOD test_basic.
              cl_abap_unit_assert=>assert_equals( exp = 2 act = 2 ).
            ENDMETHOD.
          ENDCLASS.

# Update Class LocalMacros (macros include: on-premise only)
update_class_local_macros:
  test_cases:
    - name: "local_macros"
      enabled: false
      description: "Update class macros include (on-premise only; not available in ABAP Cloud)"
      params:
        class_name: "ZADT_BLD_CLS13"
        # package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        macrosCode_create: |
          DEFINE _local_noop.
            ASSERT 1 = 1.
          END-OF-DEFINITION.
        macrosCode_update: |
          DEFINE _local_noop.
            ASSERT 2 = 2.
          END-OF-DEFINITION.

          CLASS ZADT_BLD_CLS01 IMPLEMENTATION.
            METHOD get_text.
              rv_text = |Parents: { lines( build_parent_data( ) ) }|.
            ENDMETHOD.

            METHOD build_parent_data.
              rt_parent = VALUE #(
                ( fld1 = '0000000001' fld2 = 'Parent 1' fld3 = '20250101' )
                ( fld1 = '0000000002' fld2 = 'Parent 2' fld3 = '20250105' )
              ).
            ENDMETHOD.

            METHOD build_child_data.
              rt_child = VALUE #(
                ( parent_id = '0000000001' chld_id = 'C01' )
                ( parent_id = '0000000001' chld_id = 'C02' )
                ( parent_id = '0000000002' chld_id = 'C03' )
              ).
            ENDMETHOD.
            ENDCLASS.

# Create Package
create_package:
  test_cases:
    - name: "adt_package"
      enabled: true
      description: "Package reserved for AdtPackage tests"
      params:
        package_name: "ZADT_BLD_PKG01"          # Parent package (existing)
        test_package: "ZADT_BLD_INNER_PKG01"    # Package created by the test
        description: "AdtPackage workflow package"
        updated_description: "AdtPackage workflow package - updated"  # Description for update operation
        package_type: "development"             # Optional: development, main, structure, etc.
        # software_component: "HOME"            # Optional: Software component name (can be empty)
        # transport_layer: ""                   # Optional: Transport layer (can be empty)
        # transport_request: ""                 # Optional: Transport request number (used in query param, not in body)

# Create Domain
create_domain:
  test_cases:
    - name: "adt_domain"
      enabled: true
      description: "Domain used by AdtDomain workflow tests"
      params:
        domain_name: "ZADT_BLD_DOM01"
        description: "AdtDomain workflow domain"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        datatype: "CHAR"
        length: 5
        decimals: 0
        lowercase: false
        sign_exists: false

# Create Data Element
create_data_element:
  test_cases:
    - name: "adt_data_element"
      enabled: true
      description: "Data element reserved for AdtDataElement tests"
      params:
        data_element_name: "ZADT_BLD_DTEL01"
        description: "AdtDataElement workflow data element"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        # Allowed type_kind values:
        #   - domain
        #   - predefinedAbapType
        #   - refToPredefinedAbapType
        #   - refToDictionaryType
        #   - refToClifType
        type_kind: "predefinedAbapType"
        data_type: "CHAR"
        length: 100
        decimals: 0
        short_label: "Adt"
        medium_label: "Adt Data"
        long_label: "Adt Data Element"
        heading_label: "Adt Data Element"

# Create Interface
create_interface:
  test_cases:
    - name: "adt_interface"
      enabled: true
      description: "Interface reserved for AdtInterface tests"
      params:
        interface_name: "ZADT_BLD_IF01"
        description: "AdtInterface workflow interface"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        source_code: |
          INTERFACE ZADT_BLD_IF01
            PUBLIC .
            METHODS: test_method.
          ENDINTERFACE.
      operation_delays:
        create: 5000  # Increased delay for interface creation
        lock: 3000
        update: 3000
        unlock: 3000

# Create Program
# ⚠️ ABAP Cloud Limitation: Programs are not supported in cloud systems (BTP ABAP Environment)
create_program:
  test_cases:
    - name: "adt_program"
      enabled: true
      available_in: ["onprem"]  # Programs are not supported in cloud systems
      description: "Program reserved for AdtProgram tests. Only available on on-premise systems."
      params:
        program_name: "ZADT_BLD_PROG01"
        description: "AdtProgram workflow report"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        program_type: "executable"
        source_code: |
          REPORT ZADT_BLD_PROG01.
          WRITE: / 'Adt test program'.

# Create Table
create_table:
  test_cases:
    - name: "adt_table"
      enabled: true
      description: "Table reserved for AdtTable tests"
      params:
        table_name: "ZADT_BLD_TAB01"
        description: "AdtTable workflow table"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        delivery_class: "A"
        data_class: "APPL0"
        ddl_code: |
          @EndUserText.label: 'Adt test table'
          @AbapCatalog.enhancement.category: #NOT_EXTENSIBLE
          @AbapCatalog.tableCategory: #TRANSPARENT
          @AbapCatalog.deliveryClass: #A
          @AbapCatalog.dataMaintenance: #RESTRICTED
          define table ZADT_BLD_TAB01 {
            key mandt          : abap.clnt not null;
            key builder_id     : abap.char(10) not null;
            description        : abap.char(40);
            last_changed_by    : abap.char(12);
            last_changed_on    : abap.dats;
          }

# Create TableType (DDIC Table Type)
# TableType is XML-based entity (like Domain/DataElement)
# Create: creates empty TableType (rowType added via update)
create_tabletype:
  test_cases:
    - name: "adt_tabletype"
      enabled: true
      description: "TableType reserved for TableType tests"
      params:
        tabletype_name: "ZADT_BLD_TTYP01"
        description: "TableType workflow table type"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        # XML format parameters (for update - rowType added after create)
        row_type_name: "ZADT_BLD_STRU01"  # Structure name (must exist)
        row_type_kind: "dictionaryType"   # Type kind: dictionaryType, predefinedAbapType, etc.
        access_type: "standard"           # standard, sorted, hashed, index
        primary_key_definition: "standard"  # standard, rowType, keyComponents, empty
        primary_key_kind: "nonUnique"    # unique, nonUnique

# Create Structure
create_structure:
  test_cases:
    - name: "adt_structure"
      enabled: true
      description: "Structure reserved for AdtStructure tests"
      params:
        structure_name: "ZADT_BLD_STRU01"
        description: "AdtStructure workflow structure"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        ddl_code: |
          @EndUserText.label: 'AdtStructure workflow structure'
          @AbapCatalog.enhancement.category: #NOT_EXTENSIBLE
          define structure ZADT_BLD_STRU01 {
            mandt : abap.clnt;
            field1 : abap.int1;
          }

# Create View
create_view:
  test_cases:
    - name: "adt_view"
      enabled: true
      description: "View reserved for AdtView tests"
      params:
        package_name: "ZADT_BLD_PKG01"
        table_name: "ZADT_VIEW_TBL01"
        view_name: "ZADT_BLD_VIEW01"
        description: "AdtView workflow view"
        transport_request: ""
        # skip_cleanup: false  # Set to true to skip cleanup after test (objects left for analysis)
        table_source: |
          @EndUserText.label: 'Adt view test table'
          @AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
          @AbapCatalog.tableCategory : #TRANSPARENT
          @AbapCatalog.deliveryClass : #A
          @AbapCatalog.dataMaintenance : #RESTRICTED
          define table zadt_view_tbl01 {
            key client : abap.clnt not null;
            key id     : abap.char(10) not null;
            name       : abap.char(50);
            value      : abap.dec(10,2);
            created_at : abap.dats;
          }
        ddl_source: |
          @EndUserText.label: 'Adt view on custom table'
          @AccessControl.authorizationCheck: #NOT_REQUIRED
          define view entity ZADT_BLD_VIEW01
            as select from zadt_view_tbl01
          {
            key id,
            name,
            value,
            created_at
          }

# Create Service Definition
create_service_definition:
  test_cases:
    - name: "adt_service_definition"
      enabled: false  # Set to true and configure params below to enable tests
      description: "Service definition reserved for AdtServiceDefinition tests"
      params:
        service_definition_name: "ZADT_BLD_SRVD01"  # Replace with your service definition name
        description: "AdtServiceDefinition workflow service definition"
        # package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        source_code: |
          @EndUserText.label: 'AdtServiceDefinition workflow service definition'
          define service ZADT_BLD_SRVD01 {
            expose ZOK_C_CDS_TEST;  # Replace with your CDS view name
          }

# Create Service Binding
create_service_binding:
  test_cases:
    - name: "adt_service_binding"
      enabled: false  # Set to true and configure params below to enable tests
      description: "Service binding reserved for AdtServiceBinding tests"
      params:
        binding_name: "ZADT_BLD_SRVB01"  # Replace with your service binding name
        service_definition_name: "ZOK_CDS_TEST_SRV"  # Existing SRVD name used by ServiceBinding integration test
        service_name: "ZOK_CDS_TEST_SRV"  # Usually same as service_definition_name
        service_version: "0001"
        binding_type: "ODATA"
        binding_version: "V4"  # V2 or V4
        service_type: "odatav4"  # odatav2 or odatav4 (must match binding_version)
        desired_publication_state: "published"  # published | unpublished | unchanged
        description: "AdtServiceBinding workflow service binding"
        # software_component: "HOME"  # Optional; if omitted, inherited from parent package metadata
        package_type: "development"
        # parent_package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # test_subpackage_name: "ZADT_BLD_PKG01_SRVB"  # Created automatically if missing
        # transport_request: ""  # Uses environment.default_transport if omitted
# Create Function Group
create_function_group:
  test_cases:
    - name: "adt_function_group"
      enabled: true
      description: "Function group reserved for AdtFunctionGroup tests"
      params:
        function_group_name: "ZADT_BLD_FGR_EMPTY"
        description: "AdtFunctionGroup workflow FUGR"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""

# Create Function Module
create_function_module:
  test_cases:
    - name: "adt_function_module"
      enabled: true
      description: "Function module reserved for AdtFunctionModule tests"
      params:
        function_module_name: "Z_ADT_BLD_FM01"  # Must start with Z_ or Y_ (with underscore)
        function_group_name: "ZADT_BLD_FGR02"  # Different from AdtFunctionGroup test (ZADT_BLD_FGR01)
        description: "AdtFunctionModule workflow FM"
        # package_name: "ZADT_BLD_PKG01"
        # transport_request: ""
        source_code: |
          FUNCTION Z_ADT_BLD_FM01
            IMPORTING
              VALUE(IV_PARAM) TYPE STRING
            EXPORTING
              VALUE(EV_RESULT) TYPE STRING.
            ev_result = |Result: { iv_param }|.
          ENDFUNCTION.

# Create Transport
create_transport:
  test_cases:
    - name: "adt_transport"
      enabled: true
      description: "Transport reserved for AdtRequest tests"
      params:
        description: "AdtRequest workflow transport"
        # package_name: "ZADT_BLD_PKG01"

# Create Behavior Definition
create_behavior_definition:
  test_cases:
    - name: "adt_behavior_definition"
      enabled: true
      description: "Create test behavior definition for AdtBehaviorDefinition tests"
      params:
        bdef_name: "<YOUR_BEHAVIOR_DEFINITION_NAME>"  # e.g., ZADT_BLD_BDEF01
        description: "Behavior Definition for <YOUR_CDS_VIEW_NAME>"
        package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        root_entity: "<YOUR_CDS_VIEW_NAME>"  # Root entity name (CDS view name)
        implementation_type: "Managed"  # Managed, Unmanaged, Abstract, or Projection
        source_code: |
          managed implementation in class zbp_<your_cds_view_name_lowercase> unique;
          strict ( 2 );

          define behavior for <YOUR_CDS_VIEW_NAME>
          persistent table z_<your_cds_view_name_lowercase>
          lock master
          authorization master ( instance )
          {
            create;
            update;
            delete;
          }

# Create Metadata Extension
create_metadata_extension:
  test_cases:
    - name: "adt_metadata_extension"
      enabled: true
      description: "Create test metadata extension for AdtMetadataExtension tests"
      params:
        ext_name: "<YOUR_METADATA_EXTENSION_NAME>"  # e.g., ZADT_BLD_MEXT01
        description: "Metadata Extension for <YOUR_CDS_VIEW_NAME>"
        package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        target_entity: "<YOUR_CDS_VIEW_NAME>"  # Target CDS view name
        source_code: |
          @Metadata.layer: layer
          extend view <YOUR_CDS_VIEW_NAME> with "<YOUR_METADATA_EXTENSION_NAME>"
          {
            @EndUserText.label: 'Sample Field'
            SampleField;
          }

# Create Behavior Implementation
create_behavior_implementation:
  test_cases:
    - name: "adt_behavior_implementation"
      enabled: true
      description: "Create test behavior implementation class for AdtBehaviorImplementation tests"
      params:
        class_name: "<YOUR_BEHAVIOR_IMPLEMENTATION_CLASS_NAME>"  # e.g., ZBP_<your_cds_view_name>
        description: "Behavior Implementation for <YOUR_BEHAVIOR_DEFINITION_NAME>"
        package_name: "ZADT_BLD_PKG01"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        behavior_definition: "<YOUR_BEHAVIOR_DEFINITION_NAME>"  # Root entity name (BDEF name)
        source_code: |
          CLASS lhc_<your_behavior_definition_name> DEFINITION INHERITING FROM cl_abap_behavior_handler.
            PRIVATE SECTION.

              METHODS get_instance_authorizations FOR INSTANCE AUTHORIZATION
                IMPORTING keys REQUEST requested_authorizations FOR <your_behavior_definition_name_lowercase> RESULT result.

              METHODS get_global_authorizations FOR GLOBAL AUTHORIZATION
                IMPORTING REQUEST requested_authorizations FOR <your_behavior_definition_name_lowercase> RESULT result.

          ENDCLASS.

          CLASS lhc_<your_behavior_definition_name> IMPLEMENTATION.

            METHOD get_instance_authorizations.
            ENDMETHOD.

            METHOD get_global_authorizations.
            ENDMETHOD.

          ENDCLASS.

# Run Unit Test
run_unit_test:
  test_cases:
    - name: "adt_unit_test"
      enabled: true
      description: "Run unit test for class test class"
      params:
        package_name: "<YOUR_PACKAGE_NAME>"  # e.g., ZADT_BLD_PKG01
        transport_request: ""
        source_code: |
          CLASS <YOUR_CONTAINER_CLASS_NAME> DEFINITION PUBLIC FINAL CREATE PUBLIC.
            PUBLIC SECTION.
              METHODS test_method.
          ENDCLASS.
          CLASS <YOUR_CONTAINER_CLASS_NAME> IMPLEMENTATION.
            METHOD test_method.
              " Test method implementation
            ENDMETHOD.
          ENDCLASS.
        test_class_source: |
          CLASS <YOUR_TEST_CLASS_NAME> DEFINITION FINAL FOR TESTING RISK LEVEL HARMLESS DURATION SHORT.
            PRIVATE SECTION.
              METHODS test_method FOR TESTING.
          ENDCLASS.
          CLASS <YOUR_TEST_CLASS_NAME> IMPLEMENTATION.
            METHOD test_method.
              cl_abap_unit_assert=>assert_true( abap_true ).
            ENDMETHOD.
          ENDCLASS.
        test_class:
          enabled: true
          run_unit_test: true
          container_class: "<YOUR_CONTAINER_CLASS_NAME>"  # e.g., ZADT_BLD_CLS01
          name: "<YOUR_TEST_CLASS_NAME>"  # e.g., LTCL_ZADT_BLD_CLS01
        # skip_cleanup: false  # Set to true to skip cleanup after test (test class left for analysis)
        unit_test_options:
          title: "<YOUR_TEST_CLASS_NAME>"
          context: "Adt Class ABAP Unit"
          scope:
            own_tests: true
            foreign_tests: false
            add_foreign_tests_as_preview: true
          risk_level:
            harmless: true
            dangerous: true
            critical: true
          duration:
            short: true
            medium: true
            long: true
        unit_test_status:
          with_long_polling: true
        unit_test_result:
          with_navigation_uris: false
          format: "abapunit"  # or "junit"

# Create CDS Unit Test
create_cds_unit_test:
  test_cases:
    - name: "cds_unit_test"
      enabled: true
      description: "CDS view with ABAP Unit verification (CDS view must be created manually before test)"
      params:
        package_name: "ZADT_BLD_PKG01"
        # view_name: CDS view name that must exist and be active (created manually)
        view_name: "<YOUR_CDS_VIEW_NAME>"  # e.g., ZOK_I_CDS_TEST
        description: "AdtView CDS unit test view"
        transport_request: ""
        # skip_cleanup: false  # Set to true to skip cleanup after test (test class left for analysis)
        # Note: CDS view and table must be created manually before running this test
        unit_test_options:
          scope:
            ownTests: true
            foreignTests: false
          riskLevel:
            harmless: true
            dangerous: true
            critical: true
          duration:
            short: true
            medium: true
            long: true
        unit_test_status:
          with_long_polling: true
        unit_test_result:
          with_navigation_uris: false
          format: "abapunit"
        cds_unit_test:
          class_name: "<YOUR_CDS_UNIT_TEST_CLASS_NAME>"  # e.g., ZADT_BLD_CDS_UT01
          test_class_name: "<YOUR_TEST_CLASS_NAME>"  # e.g., LTC_<YOUR_CDS_VIEW_NAME>
          description: "CDS unit test class"
          transport_request: ""
          template_xml: |
            <abapsource:template abapsource:name="IF_FOR_AUTO_CLASS_GENERATION">
              <abapsource:property abapsource:key="CCAU_CONTENT">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
            &lt;cds:cdstobetested xmlns:cds="http://www.sap.com/adt/cdsfrwk/cds"&gt;
              &lt;cds:cdsundertest api_doc="true" cds_name="<YOUR_CDS_VIEW_NAME>" cds_test_type="UNIT_TEST"&gt;
                &lt;cds:testmethods&gt;
                  &lt;cds:testmethod test_method_name="AUNIT_FOR_CDS_METHOD"/&gt;
                &lt;/cds:testmethods&gt;
              &lt;/cds:cdsundertest&gt;
            &lt;/cds:cdstobetested&gt;
            </abapsource:property>
              <abapsource:property abapsource:key="Content-Type">application/vnd.sap.adt.oo.cds.codgen.v1+xml</abapsource:property>
            </abapsource:template>
          test_class_source: |
            "!@testing <YOUR_CDS_UNIT_TEST_CLASS_NAME>
            CLASS <YOUR_TEST_CLASS_NAME> DEFINITION FINAL
              FOR TESTING RISK LEVEL HARMLESS DURATION SHORT.

              PRIVATE SECTION.
                CLASS-DATA environment TYPE REF TO if_cds_test_environment.

                DATA td_<your_table_name> TYPE STANDARD TABLE OF <your_table_name> WITH EMPTY KEY.
                DATA act_results TYPE STANDARD TABLE OF <your_cds_view_name> WITH EMPTY KEY.

                "! In CLASS_SETUP, corresponding doubles and clone(s) for the CDS view under test and its dependencies are created.
                CLASS-METHODS class_setup RAISING cx_static_check.
                "! In CLASS_TEARDOWN, Generated database entities (doubles & clones) should be deleted at the end of test class execution.
                CLASS-METHODS class_teardown.

                "! SETUP method creates a common start state for each test method,
                "! clear_doubles clears the test data for all the doubles used in the test method before each test method execution.
                METHODS setup RAISING cx_static_check.
                METHODS prepare_testdata.
                "! In this method test data is inserted into the generated double(s) and the test is executed and
                "! the results should be asserted with the actuals.
                METHODS aunit_for_cds_method FOR TESTING RAISING cx_static_check.
            ENDCLASS.

            CLASS <YOUR_TEST_CLASS_NAME> IMPLEMENTATION.

              METHOD class_setup.
                environment = cl_cds_test_environment=>create( i_for_entity = '<YOUR_CDS_VIEW_NAME>' ).
              ENDMETHOD.

              METHOD setup.
                environment->clear_doubles( ).
              ENDMETHOD.

              METHOD class_teardown.
                environment->destroy( ).
              ENDMETHOD.

              METHOD aunit_for_cds_method.
                prepare_testdata( ).
                SELECT * FROM <your_cds_view_name> INTO TABLE @act_results.
                cl_abap_unit_assert=>fail( msg = 'Place your assertions here' ).
              ENDMETHOD.

              METHOD prepare_testdata.
                " Prepare test data for '<your_table_name>'
                td_<your_table_name> = VALUE #(
                  (
                    client = '100'
                    " Add your test data fields here
                  )
                ).
                environment->insert_test_data( i_data = td_<your_table_name> ).
              ENDMETHOD.

            ENDCLASS.

# Group Activation Test
group_activation:
  test_cases:
    - name: "adt_group_activation"
      enabled: true
      description: "Group activation test - domain, data element, structure"
      params:
        domain_name: "ZADT_BLD_DOM_GRP"
        data_element_name: "ZADT_BLD_DTEL_GRP"
        structure_name: "ZADT_BLD_STRU_GRP"
        description: "Group activation test objects"
        # package_name: "ZADT_BLD_PKG03"  # Uses environment.default_package if omitted
        # transport_request: ""  # Uses environment.default_transport if omitted
        domain_datatype: "CHAR"
        domain_length: 10
        domain_decimals: 0
        data_element_type_kind: "domain"
        structure_ddl_code: |
          @EndUserText.label: 'Group activation test structure'
          @AbapCatalog.enhancement.category: #NOT_EXTENSIBLE
          define structure ZADT_BLD_STRU_GRP {
            mandt : abap.clnt;
            test_field : ZADT_BLD_DTEL_GRP;
          }

# ============================================================================
# SHARED TESTS (Utility functions - AdtUtils)
# ============================================================================

# Virtual Folders Contents (getVirtualFoldersContents)
virtual_folders_contents:
  test_cases:
    - name: "fetch_virtual_folders_contents"
      enabled: false  # Set to true to enable test
      description: "Test getVirtualFoldersContents for package browsing"
      params:
        # package_names: ["ZPKG1", "ZPKG2"]  # Optional: overrides package_name/default_package
        # package_name: "<YOUR_PACKAGE_NAME>"  # Uses environment.default_package if omitted
        object_search_pattern: "*"
        facet_order: ["package", "group", "type"]

# Object Structure (getObjectStructure)
object_structure:
  test_cases:
    - name: "get_object_structure"
      enabled: false  # Set to true to enable test
      description: "Test getObjectStructure for a standard class"
      params:
        object_type: "CLAS/OC"
        # object_name: Uses standard_objects.classes if not specified
        # class_name: Optional alias; uses standard_objects.classes if omitted

# Node Structure (fetchNodeStructure)
node_structure:
  test_cases:
    - name: "fetch_node_structure"
      enabled: false  # Set to true to enable test
      description: "Test fetchNodeStructure for a standard class"
      params:
        parent_type: "CLAS/OC"
        # parent_name: Uses standard_objects.classes if not specified
        # node_id: "0000"
        # with_short_descriptions: true

# Package Hierarchy (getPackageHierarchy)
package_hierarchy:
  test_cases:
    - name: "get_package_hierarchy"
      enabled: false  # Set to true to enable test
      description: "Test getPackageHierarchy for a package"
      # package_name: "<YOUR_PACKAGE_NAME>"  # Uses environment.default_package if omitted
      params: {}

# Read Accept (read methods should return 2xx; 406 is error)
read_accept:
  test_cases:
    - name: "read_accept"
      enabled: false  # Set to true to enable test
      description: "Read Accept headers for all read methods (expects 2xx)"
      params: {}
        # Optional overrides (if standard_objects registry doesn't cover these)
        # program_name: ""
        # view_name: ""
        # tabletype_name: ""
        # service_definition_name: ""
        # behavior_definition_name: ""
        # behavior_implementation_class_name: ""
        # metadata_extension_name: ""
        # enhancement_name: ""
        # enhancement_type: ""
        # function_group_name: ""
        # function_module_name: ""

# Table Contents (getTableContents)
# ⚠️ ABAP Cloud Limitation: Table contents reading is only available on on-premise systems
# On cloud systems, 99% of tables are not readable via ADT Data Preview endpoint
# Uses standard_objects.tables with available_in filter
table_contents:
  test_cases:
    - name: "get_table_contents"
      enabled: false  # Set to true to enable test
      available_in: ["onprem"]  # Only available on on-premise systems
      description: "Test getTableContents function - reads table data via Data Preview API. Uses standard_objects.tables filtered by available_in."
      params:
        # table_name: Uses standard_objects.tables (T000 for onprem) if not specified
        max_rows: 10  # Maximum number of rows to retrieve

    - name: "get_table_contents_default_max_rows"
      enabled: false  # Set to true to enable test
      available_in: ["onprem"]  # Only available on on-premise systems
      description: "Test getTableContents with default max_rows parameter. Uses standard_objects.tables filtered by available_in."
      params:
        # table_name: Uses standard_objects.tables (T000 for onprem) if not specified

# SQL Query (getSqlQuery)
# ⚠️ ABAP Cloud Limitation: SQL queries are only available on on-premise systems
# On cloud systems, direct SQL queries via ADT Data Preview endpoint are not supported
# Uses standard_objects.tables with available_in filter for table name in SQL query
sql_query:
  test_cases:
    - name: "execute_sql_query"
      enabled: false  # Set to true to enable test
      available_in: ["onprem"]  # Only available on on-premise systems
      description: "Test getSqlQuery function - executes SQL query via Data Preview API. Uses standard_objects.tables filtered by available_in."
      params:
        # sql_query: Uses standard_objects.tables (T000 for onprem) if not specified - will be "SELECT * FROM T000"
        row_number: 10  # Maximum number of rows to retrieve

    - name: "execute_sql_query_default_row_number"
      enabled: false  # Set to true to enable test
      available_in: ["onprem"]  # Only available on on-premise systems
      description: "Test getSqlQuery with default row_number parameter. Uses standard_objects.tables filtered by available_in."
      params:
        # sql_query: Uses standard_objects.tables (T000 for onprem) if not specified - will be "SELECT * FROM T000"

# Runtime dumps read operations (AdtRuntimeClient)
runtime_dumps:
  test_cases:
    - name: "adt_runtime_dumps"
      enabled: false  # Set to true to enable test
      description: "Read runtime dumps feed and optionally read dump payload by ID"
      params:
        top: 20
        inlinecount: "allpages"
        user: ""      # Optional: ADT user for user-filtered dump feed
        dump_id: ""   # Optional: when empty, test tries to discover ID from feed

# Runtime memory snapshots read operations (AdtRuntimeClient)
runtime_memory_snapshots:
  test_cases:
    - name: "adt_runtime_memory_snapshots"
      enabled: false  # Set to true to enable test
      description: "TODO: investigate endpoint/content-type support for runtime memory snapshots before enabling"
      params:
        user: ""          # Optional
        original_user: "" # Optional
        snapshot_id: ""   # Optional: when empty, test tries to discover ID from feed

# Execute Class (Executor API)
execute_class:
  test_cases:
    - name: "adt_class_executor"
      enabled: false
      description: "Run class via AdtExecutor (with and without profiling)"
      params:
        class_name: "ZADT_BLD_CLS023"
        source_code: |
          CLASS {{CLASS_NAME}} DEFINITION PUBLIC FINAL CREATE PUBLIC.
            PUBLIC SECTION.
              INTERFACES if_oo_adt_classrun.
              METHODS run_probe RETURNING VALUE(rv_result) TYPE i.
          ENDCLASS.

          CLASS {{CLASS_NAME}} IMPLEMENTATION.
            METHOD run_probe.
              rv_result = 1.
            ENDMETHOD.

            METHOD if_oo_adt_classrun~main.
              out->write( |{{CLASS_NAME}}=>run_probe( ) = { run_probe( ) }| ).
            ENDMETHOD.
          ENDCLASS.
        profiling:
          enabled: true
          parameters:
            all_misc_abap_statements: false
            all_procedural_units: true
            all_internal_table_events: false
            all_dynpro_events: false
            description: "ZADT_BLD_CLS023"
            aggregate: false
            explicit_on_off: false
            with_rfc_tracing: true
            all_system_kernel_events: false
            sql_trace: true
            all_db_events: true
            max_size_for_trace_file: 30720
            amdp_trace: true
            max_time_for_tracing: 1800
